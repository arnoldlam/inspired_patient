{% load staticfiles %}
{% include "dashboard/header_new.html" %}

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">{{ notebook.name }}</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div class="row">
        <div id="notes_in_notebook" class="col-lg-7">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-pencil fa-fw"></i> Notebook Details
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
	                <form id="edit_notebook_form" action="{% url 'dashboard:edit_notebook' notebook.id %}" method="post" enctype="multipart/form-data">
	                	{% csrf_token %}
	                    <div class="form-group">
	                        <label>Name</label>
	                        <input class="form-control" placeholder="{{ notebook.name }}" />
	                    </div>
	                    <div class="form-group">
	                        <label>Description</label>
	                        <input class="form-control" placeholder="{{ notebook.description }}" />
	                    </div>
	                    <div class="form-group">
	                        <label>Date Created</label>
	                        <input class="form-control" placeholder="{{ notebook.date_created }}" />
	                    </div>
						
						{# Only display options to edit notebook if user is an editor #}
	                    {% if user in notebook.editors.all %}
	                    <div class="form-group">
	                        <p><a href="{% url 'dashboard:create_new' %}?notebook_id={{notebook.id}}">Create a note in notebook</a></p>
	                    </div>
	                    <div class="form-group">
	                        <p><a data-toggle="modal" data-target="#myModal" href="#">Add Notes to this notebook</a></p>
	                    </div>
                    	<div class="row">
                    		<div class="col-lg-6">
		                    	<div class="form-group">
								    <label>Current Notebook Editors</label>
								    {% for editor in editors %}
									<li>{{ editor.user_profile.full_name }}</li>
									{% endfor %}
								</div>
                    		</div>
	                    	<div class="col-lg-6">
		                    	<div class="form-group">
									<label>Current Notebook Viewers</label>
								    {% for viewer in viewers %}
									<li>{{ viewer.user_profile.full_name }}</li>
									{% endfor %}
								</div>
                			</div>
                    	</div>
                    	<div class="row">
                    		<div class="col-lg-6">
		                    	<div class="form-group">
								    <label>Notebook Editors</label>
									{{ permissions_form.choices_for_editors }}
								</div>
                    		</div>
	                    	<div class="col-lg-6">
		                    	<div class="form-group">
									<label>Notebook Viewers</label>
									{{ permissions_form.choices_for_viewers}}
								</div>
                			</div>
                    	</div>
						<button type="submit" form="edit_notebook_form" class="btn btn-primary">Save changes</button>
						{% endif %}
	                </form>
                </div>
                <!-- /.panel-body -->
            </div>
        </div>
		<!-- /#notes_in_notebook -->

		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		                <h4 class="modal-title" id="myModalLabel">Add notes to {{ notebook.name }}</h4>
		            </div>
		            <div class="modal-body">
			            {% if notes_not_in_notebook %}
			            <form id="add_notes_to_notebook_form" action="{% url 'dashboard:add_notes_to_notebook' notebook.id %}" method="post">
			            	{% csrf_token %}
			            	<table>
			            		<tr style="font-weight:bold;">
			            			<td>Notebook</td>
			            			<td>Add to notebook</td>
			            		</tr>
			            		{% for note in notes_not_in_notebook %}
			            		<tr>
			            		<td><p>{{ note.subject }}</p></td>
			            		<!-- Append checkbox name to for-loop counter -->
			            		{% with y=forloop.counter|stringformat:"s" %}
			            		{% with checkboxName="isChecked"|add:y %}
			            		<td><input type="checkbox" name="{{ checkboxName }}" value="{{ note.id }}" /></td>
			            		{% endwith %}
			            		{% endwith %}
			            		</tr>
			            		{% endfor %}
			            	</table>
			            	<br>
			            </form>
			            {% else %}
			            <p>All your notes are already in this notebook</p>
			            {% endif %}
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		                <button type="submit" form="add_notes_to_notebook_form" class="btn btn-primary">Save changes</button>
		            </div>
		        </div>
		        <!-- /.modal-content -->
		    </div>
		    <!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

        <div id="notes_in_notebook" class="col-lg-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-pencil fa-fw"></i> Notes in Notebook
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="list-group">
                    	{% if notes_in_notebook %}
	                    	{% for note in notes_in_notebook %}
	                        <a href="{% url 'dashboard:note_detail' note.id %}?note_type={{ note.note_type }}" class="list-group-item note_box" style="padding-bottom: 20px;">
	                            <i class="fa {{ note.getFontAwesomeIconName }} fa-fw"></i> {{ note.subject }}
	                            <span class="pull-right text-muted small"><em>{{ note.date_created }}</em>
	                            </span>
	                        </a>
	                     	{% endfor %}
	                    {% endif %}
                    </div>
                    <!-- /.list-group -->
                </div>
                <!-- /.panel-body -->
            </div>
        </div>
		<!-- /#notes_in_notebook -->
    </div>
</div>
<!-- /#page-wrapper -->

{% include "dashboard/footer_new.html" %}